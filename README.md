# 院内向け簡易ベッド／部屋状況ボード (WardBoard-OSS)

このプロジェクトは、病棟や外来などのホワイトボード運用をWeb化し、部屋やベッドの「現在状態」を一目で把握するための軽量なオープンソースソフトウェアです。

## 特徴
- **個人情報を扱わない**: 患者名や病名などの個人情報は一切入力・保存・表示しません。
- **導入が簡単**: PythonとSQLiteがあれば動作します。CGI環境でも動作可能です。
- **カスタマイズ可能**: 状態（空き、使用中、清掃中など）やエリア、部屋、ベッドを自由に設定できます。
- **レスポンシブUI**: Bootstrap 5を採用し、タブレットやPCで快適に利用できます。

## 動作要件
- Python 3.7+
- bottle
- peewee
- jinja2
- itsdangerous

## セットアップ手順

1. **ライブラリのインストール**
   ```bash
   pip install bottle peewee jinja2 itsdangerous
   ```

2. **起動**
   ```bash
   python index.py
   ```
   デフォルトでは `http://localhost:8080` で起動します。

3. **初期設定**
   - 初回起動時、config.py(DEFAULT_ADMIN_USER/DEFAULT_ADMIN_PASSWORD)で管理者ユーザが作成されます
   - ログイン後、「管理」メニューから以下の順で登録を行ってください。
     1. エリア（例: A病棟、外来待ち合い）
     2. 部屋（例: 301号室、診察室1）
     3. ベッド（オプション。部屋単位運用の場合は不要）

### ダミーデータの投入
動作確認やデモのためにダミーデータを投入したい場合は、以下のスクリプトを実行してください。
```bash
python seed_data.py
```
※ すでにデータがある場合は、既存データを削除するかどうか確認が表示されます。


## よくあるカスタマイズ

### 状態の追加・変更
「管理」→「状態マスタ」から、新しい状態を追加したり、色やアイコンを変更したりできます。
- 色クラス: `bg-success`, `bg-danger`, `bg-warning`, `bg-info`, `bg-primary`, `bg-secondary`, `bg-dark` など
- アイコンクラス: [Bootstrap Icons](https://icons.getbootstrap.com/) のクラス名（例: `bi-heart-fill`）

### 部屋単位とベッド単位の使い分け
- 部屋にベッドを1つも登録しない場合、ボード上では「部屋」が状態管理の単位となります。
- 部屋にベッドを登録すると、ボード上では「ベッド」ごとに状態を管理できるようになります。

### 権限について
- **viewer**: ボードの閲覧のみ可能です。
- **operator**: ボードの閲覧と状態の変更が可能です。
- **admin**: 全ての機能（マスタ管理、ユーザー管理）が利用可能です。

## セキュリティに関する注意
- このアプリは院内LAN（クローズドネットワーク）での利用を想定しています。
- インターネットに公開する場合は、リバースプロキシでのSSL化や追加の認証設定を強く推奨します。
- [Bootstrap Icons](https://icons.getbootstrap.com/)など、CDNで参照しているライブラリはクローズドネットワークでの利用の際は適切にローカルの保存して利用してください。

## バージョン履歴
- v1.4: 運用自動化（任意）と表示負担軽減
    - 日付切替時の自動リセット機能（lazy実行方式。CGI環境対応）
        - `config.AUTO_RESET_ENABLED = True` で有効化。
        - 誰かがアクセスした際、前回実行から1日経過していれば自動実行されます。
    - 画面テーマ切替（明色/暗色モード。Cookie保存）
    - 表示専用モードの表示オプション追加（更新日時表示、コンパクト表示、空室非表示）
    - **【厳守】** 患者・個人情報は引き続き一切扱いません。入力欄・保存先ともに存在しません。
- v1.3: 施設差の吸収（状態運用の柔軟化）と簡易集計
    - 状態の適用対象（部屋/ベッド）設定機能の追加
    - 簡易集計（/summary）画面の追加。エリアごとの稼働状況を可視化
    - 利用中/空き判定のカスタマイズ設定 (`OCCUPIED_STATUS_KEYS`, `VACANT_STATUS_KEYS`)
    - 状態選択UIの改善（2列グリッド表示、アイコン表示）
    - 引き続き患者・個人情報は一切扱いません。
- v1.2: 運用ログ（変更履歴）と責任分界の明確化
    - 状態変更履歴（監査ログ）機能の追加
    - 管理画面での履歴閲覧・フィルタ機能の追加
    - ログ保持期間設定 (`LOG_RETENTION_DAYS`) と古いログの削除機能の追加
    - **【重要】** 患者・個人情報は引き続き一切扱いません。ログにも個人情報は含まれません。
- v1.1: 運用の安定化・表示専用用途強化
    - 表示専用モード (`/display/board/<area_id>`) の追加
    - 状態変更時の確認モーダル機能の追加 (configでON/OFF可能)
    - `is_active=False` の要素をボードから除外
    - クエリ最適化 (Peewee prefetch使用)
- v1.0: 初回リリース

## ライセンス
GNU Affero General Public License v3 (AGPL-3.0)
